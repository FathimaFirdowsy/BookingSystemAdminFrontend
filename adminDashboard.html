
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="assets/images/cab_icon.png" />
    <title>Admin Dashboard | Mega City Cab</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/admin.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

    <!-- Sidebar -->
    <div class="d-flex" id="wrapper">
        <nav class="bg-dark text-white sidebar">
            <div class="sidebar-header text-center py-4">
                <h4>Mega City Cab</h4>
            </div>
            <ul class="list-unstyled components">
                <li><a href="#" onclick="loadContent('driverManagement')"><i class="fa-solid fa-user-tie"></i> Driver Management</a></li>
                <li><a href="#" onclick="loadContent('userManagement')"><i class="fa-solid fa-users"></i> User Management</a></li>
                <li><a href="#" onclick="loadContent('bookingManagement')"><i class="fa-solid fa-taxi"></i> Booking Management</a></li>
                <li><a href="#" onclick="loadContent('customerReviews')"><i class="fa-solid fa-star"></i> Customer Reviews</a></li>
                <li><a href="#" onclick="loadContent('queryManagement')"><i class="fa-solid fa-envelope"></i> Query Management</a></li>
                <li><a href="#" onclick="loadContent('customerPayments')"><i class="fa-solid fa-money-bill-wave"></i> Customer Payments</a></li>
                <li><a href="#" onclick="openProfileModal()"><i class="fa-solid fa-user-circle"></i> Profile</a></li>
                <li><a href="adminLogin.html"><i class="fa-solid fa-sign-out-alt"></i> Logout</a></li>
            </ul>

        </nav>

        <!-- Main Content -->
        <div id="page-content-wrapper">
            <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom px-3">
                <button class="btn btn-dark" id="menu-toggle">â˜°</button>
                <span class="ms-auto">Welcome,</span> <span id="adminUsername">Admin</span>
            </nav>

            <div class="container-fluid mt-4">
                <div id="main-content">
                    <h2 class="text-center">Admin Dashboard</h2>
                    <p class="text-center">Select a section from the sidebar to manage</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Driver Management Content -->
    <div id="driverManagementContent" class="d-none">
        <div class="container">
        <h3>Driver Management</h3>
        <a href="createDriver.html" class="btn btn-success mb-3">Create New Driver</a>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Driver ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Contact</th>
                    <th>Work Type</th>
                    <th>Working Area</th>
                    <th>Cab ID</th>
                    <th>License Number</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="driverTableBody">
                <!-- Dynamic driver data will be inserted here -->
            </tbody>
        </table>
    </div>
    </div>

   <!-- Edit Driver Modal -->
<div class="modal fade" id="editDriverModal" tabindex="-1" aria-labelledby="editDriverModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editDriverModalLabel">Edit Driver</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editDriverForm">
                    <input type="hidden" id="editDriverID">
                    
                    <!-- Form fields for editing -->
                    <div class="mb-3">
                        <label for="editDriverName" class="form-label">Name</label>
                        <input type="text" class="form-control" id="editDriverName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editDriverEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="editDriverEmail" required>
                    </div>
                    <div class="mb-3">
                        <label for="editDriverContact" class="form-label">Contact</label>
                        <input type="text" class="form-control" id="editDriverContact" required>
                    </div>
                    <div class="mb-3">
                        <label for="editDriverWorkType" class="form-label">Work Type</label>
                        <select class="form-select" id="editDriverWorkType" required>
                            <option value="Full-Time">Full-Time</option>
                            <option value="Part-Time">Part-Time</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="editDriverWorkingArea" class="form-label">Working Area</label>
                        <input type="text" class="form-control" id="editDriverWorkingArea" required>
                    </div>
                    <div class="mb-3">
                        <label for="editDriverLicenseNo" class="form-label">License Number</label>
                        <input type="text" class="form-control" id="editDriverLicenseNo" required>
                    </div>
                    <div class="mb-3">
                        <label for="editDriverStatus" class="form-label">Status</label>
                        <select class="form-select" id="editDriverStatus" required>
                            <option value="Active">Active</option>
                            <option value="Inactive">Inactive</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


    <!-- Profile Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Admin Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p><strong>Name:</strong> Admin</p>
                    <p><strong>Email:</strong> admin@megacitycab.com</p>
                    <p><strong>Role:</strong> System Administrator</p>
                </div>
            </div>
        </div>
    </div>

    
    <script src="../vendor/bootstrap-5.3.3-dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.js"></script>
    
    <script>


            document.getElementById("menu-toggle").addEventListener("click", function () {
            document.querySelector(".sidebar").classList.toggle("d-none");
        });

        function loadContent(section) {
            const formattedSection = section.replace(/([A-Z])/g, ' $1'); // Adds spaces before uppercase letters

            // Hide all sections first
            const allSections = document.querySelectorAll('.content-section');
            allSections.forEach(section => section.classList.add('d-none'));

            // Show the selected section
            const selectedSection = document.getElementById(section + 'Content');
            if (selectedSection) {
                selectedSection.classList.remove('d-none');
            }

            // Load driver data when 'driverManagement' is selected
            if (section === 'driverManagement') {
                fetchDriverData();
            }

            document.getElementById("main-content").innerHTML = `
                <h2 class="text-center">${formattedSection}</h2>
                <p class="text-center">Content for ${formattedSection} will be loaded dynamically.</p>
            `;
        }


        // Fetch and display driver details
        function fetchDriverData() {
            fetch('http://localhost:9090/BookingSystem/DriverManagementServlet', {
                method: 'GET',
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                console.log('Driver Data:', data);

                if (data.status === 'success' && data.drivers) {
                    const driverArray = data.drivers;
                    let tableContent = '';

                    driverArray.forEach(driver => {

                        console.log('Driver:', driver); 

                        tableContent += `
                            <tr>
                                <td>${driver.DriverID}</td>
                                <td>${driver.Name}</td>
                                <td>${driver.Email}</td>
                                <td>${driver.Contact}</td>
                                <td>${driver.WorkType}</td>
                                <td>${driver.WorkingArea}</td>
                                <td>${driver.AssignedCabID}</td>
                                <td>${driver.LicenseNumber}</td>
                                <td>${driver.Status}</td>
                               
                                <td>
                                    <button class="btn btn-warning" onclick="editDriver(${driver.DriverID})">Edit</button>
                                    <button class="btn btn-danger" onclick="deleteDriver(${driver.DriverID})">Delete</button>
                                </td>
                            </tr>
                        `;
                    });
                    
                    console.log('Table Content:', tableContent); // Log table content to check before inserting
                    document.getElementById('driverTableBody').innerHTML = tableContent;
                } else {
                    console.error('No drivers found');
                    document.getElementById('driverTableBody').innerHTML = '<tr><td colspan="11" class="text-center">No drivers available</td></tr>';
                }
            })
            .catch(error => {
                console.error('Error fetching driver data:', error);
            });
        }

        // Delete driver (backend logic needed for this)
        function deleteDriver(driverId) {
            if (confirm('Are you sure you want to delete this driver?')) {
                fetch(`http://localhost:9090/BookingSystem/DriverManagementServlet?action=delete&driverID=${driverId}`, {
                    method: 'POST',
                    credentials: 'include'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        alert('Driver deleted successfully');
                        fetchDriverData(); // Reload the driver data after deletion
                    } else {
                        alert('Failed to delete driver');
                    }
                })
                .catch(error => {
                    console.error('Error deleting driver:', error);
                });
            }
        }

   // Edit driver (fetch details and populate the form)
function editDriver(driverId) {

    console.log(`Edit button clicked for driverId: ${driverId}`);  // Log the driverId

    // Make a GET request to fetch driver details based on the driverId
    fetch(`http://localhost:9090/BookingSystem/DriverManagementServlet?driverID=${driverId}&action=edit`, {
        method: 'GET',
        credentials: 'include'
    })
    .then(response => response.json())
    .then(data => {
        console.log('Fetched driver data:', data);  // Log the fetched driver data

        // Ensure that the correct driver is selected based on the driverId
        if (data.status === 'success' && data.drivers) {
            const driver = data.drivers.find(driver => driver.DriverID === driverId);  // Find the driver by DriverID

            if (driver) {
                // Populate the form with driver details
                document.getElementById('editDriverID').value = driver.DriverID;
                document.getElementById('editDriverName').value = driver.Name;
                document.getElementById('editDriverEmail').value = driver.Email;
                document.getElementById('editDriverContact').value = driver.Contact;
                document.getElementById('editDriverWorkType').value = driver.WorkType;
                document.getElementById('editDriverWorkingArea').value = driver.WorkingArea;
                document.getElementById('editDriverLicenseNo').value = driver.LicenseNumber;
                document.getElementById('editDriverStatus').value = driver.Status;

                // Show the modal with driver details
                const editModal = new bootstrap.Modal(document.getElementById('editDriverModal'));
                editModal.show();
            } else {
                alert('Driver not found.');
            }
        } else {
            alert('Error fetching driver details.');
        }
    })
    .catch(error => {
        console.error('Error fetching driver details:', error);
        alert('Error fetching driver details.');
    });
}

// Handle form submission to save driver changes
document.getElementById('editDriverForm').addEventListener('submit', function(event) {
    event.preventDefault();

    // Get updated driver data from the form
    const driverData = {
        driverID: document.getElementById('editDriverID').value,
        name: document.getElementById('editDriverName').value,
        email: document.getElementById('editDriverEmail').value,
        contact: document.getElementById('editDriverContact').value,
        workType: document.getElementById('editDriverWorkType').value,
        workingArea: document.getElementById('editDriverWorkingArea').value,
        licenseNo: document.getElementById('editDriverLicenseNo').value,
        status: document.getElementById('editDriverStatus').value
    };

    // Send the updated driver data to the backend for updating
    fetch("http://localhost:9090/BookingSystem/DriverManagementServlet", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: `action=edit&driverID=${driverData.driverID}&name=${encodeURIComponent(driverData.name)}&email=${encodeURIComponent(driverData.email)}&contact=${encodeURIComponent(driverData.contact)}&workType=${encodeURIComponent(driverData.workType)}&workingArea=${encodeURIComponent(driverData.workingArea)}&licenseNo=${encodeURIComponent(driverData.licenseNo)}&status=${encodeURIComponent(driverData.status)}`,
        credentials: "include"
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            alert('Driver details updated successfully.');
            location.reload();  // Reload the page to reflect the changes
        } else {
            alert('Error updating driver details.');
        }
    })
    .catch(error => {
        console.error('Error updating driver details:', error);
        alert('Error updating driver details.');
    });
});


    </script>

</body>
</html>
